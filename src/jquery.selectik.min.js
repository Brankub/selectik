// Copyright (c) 2012 Ivan Kubrakov 
// Selectik: a jQuery custom select plugin http://brankub.github.com/selectik/

(function(b){var f=!1,p=!1;b.selectik=function(E,M){var l,w,k,m,F,G,x,y,H,q=!1,z=!1,d,h,i,r,s,g,A,B,t,N={containerClass:"custom-select",width:0,maxItems:0,customScroll:1,speedAnimation:200},j=this;j.settings={};var c=b(E);j.init=function(){d=b.extend({},N,M);0==d.width&&(c.wrap("<span/>"),d.width=c.parent().width(),c.parent().replaceWith(c));c.wrap('<div class="'+d.containerClass+'"></div>');g=c.parent();I({refreshSelect:!1});var a=b('input[type="reset"]',c.parents("form"));0<a.length&&a.bind("click", function(){var a=0<t.length?t.index():0;C(b("option:eq("+a+")",c))});c.bind("change",function(){if(z)return z=!1;C(b("option:selected",b(this)))});r.bind("click",function(){if(g.hasClass("disable"))return!1;c.focus();D(h,!1,!0)});c.bind("focus",function(){g.addClass("active")});c.bind("blur",function(){g.removeClass("active");f&&(j.hideCS(),c.parent().removeClass("active"))});c.bind("keyup",function(a){13==a.keyCode&&h.is(":visible")&&D(h,!0,!1);b.browser.msie||27==a.keyCode&&h.is(":visible")&&D(h, !0,!0);c.change();q&&J(b("option:selected",c).index())});b.browser.opera&&c.bind("keydown",function(){p=!0})};var I=function(a){var n="";l=E.length;a.refreshSelect&&b("ul",g).remove();B=b("option",c);for(var e=0;e<B.length;e++){var f=b(B[e]);F="disabled"===f.attr("disabled")?"disabled":"";n+='<li class="'+F+'" data-value="'+f[0].value+'">'+f[0].text+"</li>"}e=0<d.maxItems&&1==d.customScroll?'<div class="select-scroll"><span class="scroll-drag"><\!-- --\></span></div>':"";f=1==d.customScroll?"custom-scroll": "default-scroll";t=b("option:selected",c);a.refreshSelect?b("<ul>"+n+"</ul>").prependTo(b(".select-list",g)):(n='<span class="custom-text">'+t[0].text+'</span><div class="select-list '+f+'">'+e+"<ul>"+n+"</ul></div>",b(n).prependTo(g));i=b("ul",g);r=b(".custom-text",g);h=b(".select-list",g);h.on("mousedown","li",function(){if(b(this).hasClass("disabled"))return!1;C(b(this))});b("li:eq("+t.index()+")",i).addClass("selected");g.removeClass("done");j.setWidthCS(d.width);w=parseInt(h.css("top"));a.refreshSelect|| (k=b("li:nth-child(1)",i).outerHeight());if(l<d.maxItems||0==d.maxItems)h.hide(),g.addClass("done");else if(q=!0,G=k*l,m=k*d.maxItems,i.css("height",m),h.hide(),g.addClass("done"),1==d.customScroll&&(a=k*l,x=-a+m,A=b(".select-scroll",h),A.css("height",m),s=b(".scroll-drag",h),h.addClass("maxlength"),y=a/m,H=m*(m/a),s.css("height",H),0<b(".selected",i).length&&J(b(".selected",i).index()),d.customScroll)){var u;i.bind("mousewheel",function(b,a){u=parseInt(i.css("top"))+a*k;v(u);return!1});A.click(function(a){a= 0.5<(a.pageY-b(this).offset().top)/m?-1:1;u=parseInt(i.css("top"))+k*a;v(u);return!1});s.on("mousedown",function(a){K(a,!0)});b(document).on("mouseup",function(a){K(a,!1)})}},K=function(a,n){if(n){a.preventDefault()&&a.preventDefault();var c=parseInt(s.css("top")),d=a.clientY;b(document).bind("mousemove",function(a){v((d-a.clientY-c)*y)})}else b(document).unbind("mousemove"),f=!0},v=function(a){a=0<a?0:a;a=a<x?x:a;i.css("top",a);s.css("top",-a/y)},J=function(a){if(!(0>a||a==l)){var c=a>l-d.maxItems? G-m:k*a;b(".selected",i).removeClass("selected");b("li:nth-child("+(a+1)+")",i).addClass("selected");q&&v(-c)}},C=function(a){var b=0<a.parents("select").length?a.attr("value"):a.data("value"),c=a.text();L(b,c,a.index()+1)},L=function(a,d,e){if(e>l||0==e)return!1;z=!0;c.attr("value",a).change();b(".selected",i).removeClass("selected");b("li:nth-child("+e+")",i).addClass("selected");r.text(d)},D=function(a,c,e){1==b("."+d.containerClass+".open_list").length&&b("."+d.containerClass+".open_list").children("select").data("selectik").hideCS(); if(!e&&(b("."+d.containerClass+".open_list").children(".select-list").stop(!0,!0).fadeOut(d.speedAnimation).parent().toggleClass("open_list"),c))return;f=!1;j.positionCS(a);a.stop(!0,!0).fadeToggle(d.speedAnimation);a.parent().toggleClass("open_list");setTimeout(function(){f=!0},d.speedAnimation)};j.hideCS=function(){h.fadeOut(d.speedAnimation);g.removeClass("open_list");c.focus();f=!0};j.showCS=function(){f=!1;h.fadeIn(d.speedAnimation);g.addClass("open_list")};j.positionCS=function(a){elParent= a.parent();var c=q?d.maxItems*k:l*k,e=q?d.maxItems:l,e=b(window).outerHeight()-(elParent.offset().top-b(window).scrollTop())-elParent.outerHeight()<c?-e*k-elParent.outerHeight()/4:w,e=elParent.offset().top-b(window).scrollTop()<c?w:e;a.css("top",e)};j.refreshCS=function(){I({refreshSelect:!0})};j.changeCS=function(a){var a=0<a.index?a.index:b('option[value="'+a.value+'"]',c).index()+1,d=b("option:nth-child("+a+")",c).attr("value"),e=b("option:nth-child("+a+")",c).text();L(d,e,a)};j.disableCS=function(){c.attr("disabled", !0);g.addClass("disable")};j.enableCS=function(){c.attr("disabled",!1);g.removeClass("disable")};j.requiredCS=function(){r.toggleClass("required")};j.setWidthCS=function(a){b.each([i,r],function(){var c=b(this).parent(),c=c.outerWidth()-c.width(),d=b(this).outerWidth()-b(this).width(),c=c+d;b(this).css("width",a-c)})};j.init()};b.fn.selectik=function(f){return this.each(function(){if(!(0<b("optgroup",this).length||"multiple"==b(this).attr("multiple"))&&void 0==b(this).data("selectik")){var p=new b.selectik(this, f);b(this).data("selectik",p)}})};b(window).resize(function(){f&&!(0<!b(".open_list").length)&&b(".open_list").children("select").data("selectik").positionCS(b(".select-list:visible"))});b(document).bind("click",function(){p?p=!1:f&&(f=!1,0<b(".open_list").length&&b(".open_list").children("select").data("selectik").hideCS())})})(jQuery);