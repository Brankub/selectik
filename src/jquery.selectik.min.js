// Copyright (c) 2012 Ivan Kubrakov 
// Selectik: a jQuery custom select plugin http://brankub.github.com/selectik/

(function(a){var b=false;var c=false;var d=false;a.selectik=function(e,f){var g,h,i,j,k,l,m,n,o,p=false,q=false,r;var s,t,u,v,w,x,y,z;var A={containerClass:"custom-select",width:0,maxItems:0,customScroll:1,speedAnimation:200};var B=this;B.settings={};var C=a(e),D=e;B.init=function(){r=a.extend({},A,f);E();N()};var E=function(){C.wrap('<div class="'+r.containerClass+'"></div>');w=C.parent();F({refreshSelect:false})};var F=function(b){var c="";g=D.length;if(b.refreshSelect){a("ul",w).remove()}y=a("option",C);for(var d=0;d<y.length;d++){var e=a(y[d]);k=e.attr("disabled")==="disabled"?"disabled":"";var f=e[0].text;var i=e[0].value;c+='<li class="'+k+'" data-value="'+i+'">'+f+"</li>"}var j=r.maxItems>0&&r.customScroll==1?'<div class="select-scroll"><span class="scroll-drag"><!-- --></span></div>':"";var l=r.customScroll==1?"custom-scroll":"default-scroll";z=a("option:selected",C);if(b.refreshSelect){c="<ul>"+c+"</ul>";a(c).prependTo(a(".select-list",w));M()}else{c='<span class="custom-text">'+z[0].text+'</span><div class="select-list '+l+'">'+j+"<ul>"+c+"</ul></div>";a(c).prependTo(w);M()}t=a("ul",w);u=a(".custom-text",w);s=a(".select-list",w);a("li:eq("+z.index()+")",t).addClass("selected");w.removeClass("done");var m=r.width>0?r.width:C.outerWidth();B.setWidthCS(m);h=parseInt(s.css("top"));G({refreshSelect:b.refreshSelect})};var G=function(b){if(!b.refreshSelect){i=a("li:nth-child(1)",t).outerHeight()}if(g<r.maxItems||r.maxItems==0){s.hide();w.addClass("done");return}p=true;l=i*g;j=i*r.maxItems;t.css("height",j);s.hide();w.addClass("done");if(r.customScroll==1){H()}};var H=function(){var b=i*g;m=-b+j;x=a(".select-scroll",s);x.css("height",j);v=a(".scroll-drag",s);s.addClass("maxlength");n=b/j;o=j*(j/b);v.css("height",o);if(a(".selected",t).length>0){L(a(".selected",t).index())}if(r.customScroll){I()}};var I=function(){var b;t.bind("mousewheel",function(a,c){b=parseInt(t.css("top"))+c*i;K(b);return false});x.click(function(c){var d=(c.pageY-a(this).offset().top)/j>.5?-1:1;b=parseInt(t.css("top"))+i*d;K(b);return false});v.on("mousedown",function(a){J(a,true)});a(document).on("mouseup",function(a){J(a,false)})};var J=function(c,d){if(d){if(c.preventDefault()){c.preventDefault()}var e=parseInt(v.css("top"));var f=c.clientY;a(document).bind("mousemove",function(a){var b=f-a.clientY-e;K(b*n)})}else{a(document).unbind("mousemove");b=true}};var K=function(a){a=a>0?0:a;a=a<m?m:a;t.css("top",a);v.css("top",-a/n)};var L=function(d){if(d<0||d==g){return}var e=d>g-r.maxItems?l-j:i*d;a(".selected",t).removeClass("selected");a("li:nth-child("+(d+1)+")",t).addClass("selected");if(b&&c){u.text(a("li:nth-child("+(d-1)+")",t).data("value"))}if(!p){return}K(-e)};var M=function(){a("li").bind("mousedown",function(){if(a(this).hasClass("disabled")){return false}P(a(this))})};var N=function(){var c=a('input[type="reset"]',C.parents("form"));if(c.length>0){c.bind("click",function(){var b=z.length>0?z.index():0;P(a("option:eq("+b+")",C))})}C.bind("change",function(){if(q){q=false;return false}P(a("option:selected",a(this)))});u.bind("click",function(){if(w.hasClass("disable")){return false}C.focus();R(s,false,true)});C.bind("focus",function(){w.addClass("active")});C.bind("blur",function(){w.removeClass("active");if(b){B.hideCS();C.parent().removeClass("active")}});C.bind("keyup",function(a){O(a)});if(a.browser.opera){C.bind("keydown",function(){d=true})}};var O=function(b){if(b.keyCode==13&&s.is(":visible")){R(s,true,false)}if(!a.browser.msie){if(b.keyCode==27&&s.is(":visible")){R(s,true,true)}}C.change();if(p){L(a("option:selected",C).index())}};var P=function(a){var b=a.parents("select").length>0?a.attr("value"):a.data("value");var c=a.text();Q(b,c,a.index()+1)};var Q=function(b,c,d){if(d>g||d==0){return false}q=true;C.attr("value",b).change();a(".selected",t).removeClass("selected");a("li:nth-child("+d+")",t).addClass("selected");u.text(c)};var R=function(c,d,e){if(a("."+r.containerClass+".open_list").length==1){a("."+r.containerClass+".open_list").children("select").data("selectik").hideCS()}if(!e){a("."+r.containerClass+".open_list").children(".select-list").stop(true,true).fadeOut(r.speedAnimation).parent().toggleClass("open_list");if(d){return}}b=false;B.positionCS(c);c.stop(true,true).fadeToggle(r.speedAnimation);c.parent().toggleClass("open_list");setTimeout(function(){b=true},r.speedAnimation)};B.hideCS=function(){s.fadeOut(r.speedAnimation);w.removeClass("open_list");C.focus();b=true};B.showCS=function(){b=false;s.fadeIn(r.speedAnimation);w.addClass("open_list")};B.positionCS=function(b){elParent=b.parent();var c=p?r.maxItems*i:g*i;var d=p?r.maxItems:g;var e=a(window).outerHeight()-(elParent.offset().top-a(window).scrollTop())-elParent.outerHeight()<c?-d*i-elParent.outerHeight()/4:h;e=elParent.offset().top-a(window).scrollTop()<c?h:e;b.css("top",e)};B.refreshCS=function(){F({refreshSelect:true})};B.changeCS=function(b){var c=b.index>0?b.index:a('option[value="'+b.value+'"]',C).index()+1;var d=a("option:nth-child("+c+")",C).attr("value");Q(d,c)};B.disableCS=function(){C.attr("disabled",true);w.addClass("disable")};B.enableCS=function(){C.attr("disabled",false);w.removeClass("disable")};B.requiredCS=function(){u.toggleClass("required")};B.setWidthCS=function(a){t.css("width",a);u.css("width",a)};B.init()};a.fn.selectik=function(b){return this.each(function(){if(a("optgroup",this).length>0||a(this).attr("multiple")=="multiple"){return}if(undefined==a(this).data("selectik")){var c=new a.selectik(this,b);a(this).data("selectik",c)}})};a(window).resize(function(){if(b){if(!a(".open_list").length>0){return}a(".open_list").children("select").data("selectik").positionCS(a(".select-list:visible"))}});a(document).bind("click",function(){if(d){d=false;return}if(b){b=false;if(a(".open_list").length>0){a(".open_list").children("select").data("selectik").hideCS()}}})})(jQuery)