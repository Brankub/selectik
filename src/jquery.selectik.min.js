(function($){var openList=false;var selectControl=false;var trigger=false;var mouseTrigger=false;var isMobile=/android|iphone|ipad|ipod|android/i.test(navigator.userAgent.toLowerCase());var isOpera=/opera/i.test(navigator.userAgent.toLowerCase());var isIE=/msie/i.test(navigator.userAgent.toLowerCase());var isOperaMini=Object.prototype.toString.call(window.operamini)==="[object OperaMini]";Selectik=function(options){this.config=$.extend(true,{containerClass:"custom-select",width:0,maxItems:0,customScroll:1,speedAnimation:200,smartPosition:true,minScrollHeight:10},options||{})};Selectik.prototype={_init:function(element){this.$cselect=$(element);this.cselect=element;this.scrollL=false;this.change=false;this.fixScroll=false;this.mouseDown=false;if(this.config.width==0){this.$cselect.wrap("<span/>");this.config.width=this.$cselect.parent().width();this.$cselect.parent().replaceWith(this.$cselect)}this._generateContainer();this._handlers()},_generateContainer:function(){this.$cselect.wrap('<div class="'+this.config.containerClass+(this.$cselect.attr("disabled")==="disabled"?" disabled":"")+'"></div>');this.$container=this.$cselect.parent();this._getList({refreshHtml:false})},_getList:function(e){this.count=this.cselect.length;if(e.refreshSelect){$(".select-list",this.$container).remove()}var html=this._generateHtml();var scrollHtml=this.config.maxItems>0&&this.config.customScroll==1?'<div class="select-scroll"><span class="scroll-drag"><!-- --></span></div>':"";var scrollClass=this.config.customScroll==1?"custom-scroll":"default-scroll";this.$selected=$("option:selected",this.$cselect);if(e.refreshSelect){html='<div class="select-list '+scrollClass+'">'+scrollHtml+"<ul>"+html+"</ul></div>";$(html).prependTo(this.$container)}else{html='<span class="custom-text">'+this.$selected[0].text+'</span><div class="select-list '+scrollClass+'">'+scrollHtml+"<ul>"+html+"</ul></div>";$(html).prependTo(this.$container)}this.$list=$("ul",this.$container);this.$text=$(".custom-text",this.$container);this.$listContainer=$(".select-list",this.$container);this._clickHandler();$("li:eq("+this.$selected.index()+")",this.$list).addClass("selected");this.$container.removeClass("done");this.setWidthCS(this.config.width);this.standardTop=parseInt(this.$listContainer.css("top"));this._getLength({refreshSelect:e.refreshSelect})},_generateHtml:function(){this.$collection=this.$cselect.children();var html="";for(var i=0;i<this.$collection.length;i++){var $this=$(this.$collection[i]);html+='<li class="'+($this.attr("disabled")==="disabled"?"disabled":"")+'" data-value="'+$this[0].value+'">'+($this.data("selectik")?$this.data("selectik"):$this[0].text)+"</li>"}return html},_getLength:function(e){var selectik=this;if(!e.refreshSelect){this.heightItem=$("li:nth-child(1)",this.$list).outerHeight();this.totalItemsHeight=0;this.totalContainerHeight=0;$("li",this.$list).each(function(index,el){selectik.totalItemsHeight+=$(this).outerHeight();if(index<selectik.config.maxItems){selectik.totalContainerHeight+=$(this).outerHeight()}})}if(this.count<this.config.maxItems||this.config.maxItems==0){this.$listContainer.hide();this.$container.addClass("done");this.scrollL=false;return}this.scrollL=true;this.heightList=this.totalItemsHeight;this.heightContainer=this.totalContainerHeight;this.$list.css("height",this.heightContainer);this.$listContainer.hide();this.$container.addClass("done");if(this.config.customScroll==1){this._getScroll()}},_getScroll:function(){var allHeight=this.totalItemsHeight;this.heightShift=-allHeight+this.heightContainer;this.$bgScroll=$(".select-scroll",this.$listContainer);this.$bgScroll.css("height",this.heightContainer);this.$scroll=$(".scroll-drag",this.$listContainer);this.$listContainer.addClass("maxlength");this.relating=allHeight/this.heightContainer;this.heightScroll=this.heightContainer*(this.heightContainer/allHeight);if(this.heightScroll<this.config.minScrollHeight){this.heightScroll=this.config.minScrollHeight;this.fixScroll=true}this.$scroll.css("height",this.heightScroll);if($(".selected",this.$list).length>0){this._shift($(".selected",this.$list).index())}if(this.config.customScroll){this._scrollHandlers()}},_scrollHandlers:function(){var shiftL;var selectik=this;this.$list.bind("mousewheel",function(event,deltaY){shiftL=parseInt(selectik.$list.css("top"))+deltaY*selectik.heightItem;selectik._shiftHelper(shiftL);return false});this.$bgScroll.click(function(e){var direction=(e.pageY-$(this).offset().top)/selectik.heightContainer>.5?-1:1;shiftL=parseInt(selectik.$list.css("top"))+selectik.heightItem*direction;selectik._shiftHelper(shiftL);return false});this.$text.on("mousedown",function(e){selectik._draggable(e,true)});this.$scroll.on("mousedown",function(e){mouseTrigger=false;selectik._draggable(e,true)});$(document).on("mouseup",function(e){selectik._draggable(e,false)})},_draggable:function(e,on){var selectik=this;if(on){openList=false;if(e.preventDefault()){e.preventDefault()}var startPosition=parseInt(selectik.$scroll.css("top"));var helper=e.clientY;var textHeight=selectik.$text.outerHeight();$(document).bind("mousemove",function(e){if(mouseTrigger){var listTopPosition=selectik.$list.parent().offset().top;var listHeight=selectik.$list.outerHeight();var direction=selectik.topPosition>0?-1:1;var difference=selectik.topPosition>0?textHeight:0;var cursorPosition=e.clientY-(listTopPosition-difference-$(window).scrollTop());if(cursorPosition<0||cursorPosition>listHeight+textHeight){var deltaY=cursorPosition<0?1:-1;var shiftL=parseInt(selectik.$list.css("top"))+deltaY*selectik.heightItem;selectik._shiftHelper(shiftL)}}else{var newPosition=helper-e.clientY-startPosition;selectik._shiftHelper(newPosition*selectik.relating)}})}else{$(document).unbind("mousemove");openList=true}},_shiftHelper:function(e){e=e>0?0:e;e=e<this.heightShift?this.heightShift:e;this.$list.css("top",e);var scrollPosition=this.fixScroll?-(e/this.relating+e/this.heightShift*this.config.minScrollHeight):-(e/this.relating);this.$scroll.css("top",scrollPosition)},_shift:function(indexEl){if(indexEl<0||indexEl==this.count){return}this.topShift=indexEl>this.count-this.config.maxItems?this.heightList-this.heightContainer:this.heightItem*indexEl;$(".selected",this.$list).removeClass("selected");var $selectedLi=$("li:nth-child("+(indexEl+1)+")",this.$list);$selectedLi.addClass("selected");if(openList&&selectControl){this.$text.text($selectedLi.data("value"))}if(!this.scrollL){return}this._shiftHelper(-this.topShift)},_clickHandler:function(){var selectik=this;this.$listContainer.off("mousedown","li").on("mousedown","li",function(e){if(selectik.change){selectik.change=false;return true}if(!selectik._checkDisabled($(this),e))return;selectik.change=true;selectik._changeSelected($(this))})},_handlers:function(){var selectik=this;var $reset=$('input[type="reset"]',this.$cselect.parents("form"));if($reset.length>0){$reset.bind("click",function(){var index=selectik.$selected.length>0?selectik.$selected.index():0;selectik._changeSelected($("option:eq("+index+")",selectik.$cselect))})}this.$cselect.bind("change",function(){if(selectik.change){selectik.change=false;return true}selectik._changeSelected($("option:selected",$(this)))});this.$text.bind("click",function(e){if(selectik.$container.hasClass("disabled")||mouseTrigger){return false}selectik.$cselect.focus();selectik._fadeList(false,true)});this.$text.bind("mousedown",function(e){if(!selectik._checkDisabled(selectik.$container,e))return;e.preventDefault();selectik.mouseDown=true;setTimeout(function(){if(selectik.mouseDown){mouseTrigger=true;selectik._fadeList(false,true)}},300)});this.$text.bind("mouseup",function(){selectik.mouseDown=false});this.$listContainer.on("mouseup","li",function(e){if(!mouseTrigger){return true}if($(this).hasClass("disabled")){return}selectik.change=true;selectik._changeSelected($("option:eq("+$(e.currentTarget).index()+")",selectik.$cselect));selectik.hideCS(true);mouseTrigger=false;selectik.$cselect.focus()});this.$cselect.bind("focus",function(){selectik.$container.addClass("active")});this.$cselect.bind("blur",function(){if(mouseTrigger)return;selectik.hideCS(true);selectik.$container.removeClass("active")});this.$cselect.bind("keyup",function(e){selectik._keysHandlers(e)});if(isOpera){selectik.$cselect.bind("keydown",function(){trigger=true})}},_checkDisabled:function(el,e){if(el.hasClass("disabled")){e.preventDefault();return false}return true},_keysHandlers:function(e){if(e.keyCode==13&&this.$listContainer.is(":visible")){this._fadeList(true,false)}if(!isIE){if(e.keyCode==27&&this.$listContainer.is(":visible")){this._fadeList(true,true)}}this.$cselect.change();if(this.scrollL){this._shift($("option:selected",this.$cselect).index())}},_changeSelected:function(e){var dataValue=e.parents("select").length>0?e.attr("value"):e.data("value");var textValue=e.text();this._changeSelectedHtml(dataValue,textValue,e.index()+1)},_changeSelectedHtml:function(dataValue,textValue,index){if(index>this.count||index==0){return false}this.change=true;var $selected=$(".selected",this.$list);$("option:eq("+$selected.index()+")",this.$cselect).prop("selected",false);$("option:eq("+(index-1)+")",this.$cselect).prop("selected",true);this.$cselect.prop("value",dataValue).change();$selected.removeClass("selected");$("li:nth-child("+index+")",this.$list).addClass("selected");this.$text.text(textValue)},_fadeList:function(out,text){var $openList=$("."+this.config.containerClass+".open_list");if($openList.length==1){$openList.children("select").data("selectik").hideCS();return}if(!text){$openList.children(".select-list").stop(true,true).fadeOut(this.config.speedAnimation).parent().toggleClass("open_list");if(out){return}}openList=false;this.positionCS();this.$listContainer.stop(true,true).fadeToggle(this.config.speedAnimation);this.$listContainer.parent().toggleClass("open_list");var selectik=this;setTimeout(function(){openList=true},selectik.config.speedAnimation)},hideCS:function(next){this.$listContainer.fadeOut(this.config.speedAnimation);this.$container.removeClass("open_list");if(!next)this.$cselect.focus();openList=true},showCS:function(){openList=false;this.$listContainer.fadeIn(this.config.speedAnimation);this.$container.addClass("open_list")},positionCS:function(){if(!this.config.smartPosition)return;elParent=this.$listContainer.parent();var heightPosition=this.scrollL?this.config.maxItems*this.heightItem:this.count*this.heightItem;var quaItems=this.scrollL?this.config.maxItems:this.count;var $window=$(window);var widnowScrollTop=$window.scrollTop();var topPosition=$window.height()-(elParent.offset().top-widnowScrollTop)-elParent.outerHeight()<heightPosition?-quaItems*this.heightItem-elParent.outerHeight()/4:this.standardTop;this.topPosition=elParent.offset().top-widnowScrollTop<heightPosition&&$("html").height()-elParent.offset().top>heightPosition?this.standardTop:topPosition;this.$listContainer.css("top",this.topPosition)},refreshCS:function(){this._getList({refreshSelect:true})},changeCS:function(val){var index=val.index>0?val.index:$('option[value="'+val.value+'"]',this.$cselect).index()+1;var $option=$("option:nth-child("+index+")",this.$cselect);var dataValue=$option.attr("value");var textValue=$option.text();this._changeSelectedHtml(dataValue,textValue,index)},disableCS:function(){this.$cselect.attr("disabled",true);this.$container.addClass("disabled")},enableCS:function(){this.$cselect.attr("disabled",false);this.$container.removeClass("disabled")},requiredCS:function(){this.$text.toggleClass("required")},setWidthCS:function(width){$.each([this.$list,this.$text],function(){var $parent=$(this).parent(),parentPaddings=$parent.outerWidth()-$parent.width(),elementPaddings=$(this).outerWidth()-$(this).width(),paddings=parentPaddings+elementPaddings;$(this).css("width",width-paddings)})}};$.fn.selectik=function(options,methods){if(isMobile||isOperaMini)return;return this.each(function(){if($("optgroup",this).length>0||$(this).attr("multiple")=="multiple"){return}if(undefined==$(this).data("selectik")){var selectik=new Selectik(options);for(i in methods){selectik[i]=methods[i]}selectik._init(this);$(this).data("selectik",selectik)}})};$(window).resize(function(){if(openList){var $list=$(".open_list");if(!$list.length>0){return}$list.children("select").data("selectik").positionCS($(".select-list:visible"))}});$(document).bind("click",function(e){if($(e.target).hasClass("disabled")){return}if(trigger){trigger=false;return}if(openList){openList=false;var $list=$(".open_list");if($list.length>0){var $select=$list.children("select");$select.data("selectik").hideCS();mouseTrigger=false}}})})(jQuery);