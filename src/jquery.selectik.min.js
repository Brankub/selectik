// Copyright (c) 2012 Ivan Kubrakov 
// Selectik: a jQuery custom select plugin http://brankub.github.com/selectik/

(function(a){var b=false;var c=false;var d=false;a.selectik=function(e,f){var g,h,i,j,k,l,m,n,o,p,q=false,r="",s=false,t;var u,v,w,u,x,y,z,A;var B={containerClass:"custom-select",width:0,maxItems:0,customScroll:1,speedAnimation:200};var C=this;C.settings={};var D=a(e),E=e;C.init=function(){t=a.extend({},B,f);F();N()};var F=function(){D.wrap('<div class="'+t.containerClass+'"></div>');y=D.parent();G({refreshSelect:false})};var G=function(b){var c="";g=E.length;if(b.refreshSelect){a("ul",y).remove()}A=a("option",D);for(var d=0;d<A.length;d++){var e=a(A[d]);k=e.attr("disabled")==="disabled"?"disabled":"";var f=e.attr("value");c+='<li class="'+k+'" data-value="'+f+'">'+f+"</li>"}var i=t.maxItems>0&&t.customScroll==1?'<div class="select-scroll"><span class="scroll-drag"><!-- --></span></div>':"";var j=t.customScroll==1?"custom-scroll":"default-scroll";var l=a("option:selected",D);if(b.refreshSelect){c="<ul>"+c+"</ul>";a(c).prependTo(a(".select-list",y))}else{c='<span class="custom-text">'+l.attr("value")+'</span><div class="select-list '+j+'">'+i+"<ul>"+c+"</ul></div>";a(c).prependTo(y)}v=a("ul",y);w=a(".custom-text",y);u=a(".select-list",y);a("li:eq("+l.index()+")",v).addClass("selected");y.removeClass("done");var m=t.width>0?t.width:D.outerWidth();C.setWidthCS(m);h=parseInt(u.css("top"));H({refreshSelect:b.refreshSelect})};var H=function(b){if(!b.refreshSelect){i=a("li:nth-child(1)",v).outerHeight()}if(g<t.maxItems||t.maxItems==0){u.hide();y.addClass("done");return}q=true;l=i*g;j=i*t.maxItems;v.css("height",j);u.hide();y.addClass("done");if(t.customScroll==1){I()}};var I=function(){var b;var c=i*g;m=-c+j;z=a(".select-scroll",u);z.css("height",j);x=a(".scroll-drag",u);u.addClass("maxlength");n=c/j;p=j*(j/c);x.css("height",p);if(a(".selected",v).length>0){M(a(".selected",v).index())}if(t.customScroll==true){J()}};var J=function(){v.bind("mousewheel",function(a,b){o=parseInt(v.css("top"))+b*i;L(o);return false});z.click(function(b){var c=(b.pageY-a(this).offset().top)/j>.5?-1:1;o=parseInt(v.css("top"))+i*c;L(o);return false});x.on("mousedown",function(a){K(a,true)});a(document).on("mouseup",function(a){K(a,false)})};var K=function(c,d){if(d){if(c.preventDefault()){c.preventDefault()}var e=parseInt(x.css("top"));var f=c.clientY;a(document).bind("mousemove",function(a){var b=f-a.clientY-e;L(b*n)})}else{a(document).unbind("mousemove");b=true}};var L=function(a){a=a>0?0:a;a=a<m?m:a;v.css("top",a);x.css("top",-a/n)};var M=function(d){if(d<0||d==g){return}var e=d>g-t.maxItems?l-j:i*d;a(".selected",v).removeClass("selected");a("li:nth-child("+(d+1)+")",v).addClass("selected");if(b&&c){w.text(a("li:nth-child("+(d-1)+")",v).data("value"))}if(!q){return}L(-e)};var N=function(){D.on("change",function(){if(s){s=false;return false}P(a("option:selected",a(this)))});w.on("click",function(){if(y.hasClass("disable")){return false}D.focus();R(u,false);return false});v.on("click","li",function(b){if(a(this).hasClass("disabled")){return false}P(a(this))});D.bind("keyup",function(a){O(a)});if(a.browser.opera){D.bind("keydown",function(a){d=true})}};var O=function(b){if(b.keyCode==13||b.keyCode==27){R(u,true)}if(!u.is(":visible")){R(u,false)}D.change();if(q){M(a("option:selected",D).index())}};var P=function(a){var b=a.parents("select").length>0?a.attr("value"):a.data("value");Q(b,a.index()+1)};var Q=function(b,c){if(c>g||c==0){return false}s=true;D.attr("value",b).change();a(".selected",v).removeClass("selected");a("li:nth-child("+c+")",v).addClass("selected");w.text(b)};var R=function(c,d){a(".custom-select.open").children(".select-list").stop(true,true).fadeOut(t.speedAnimation).parent().toggleClass("open");if(d){return}b=false;C.positionCS(c);c.stop(true,true).fadeToggle(t.speedAnimation);c.parent().toggleClass("open");setTimeout(function(){b=true},t.speedAnimation)};C.hideCS=function(){u.fadeOut(t.speedAnimation);y.removeClass("open");b=true};C.showCS=function(){b=false;u.fadeIn(t.speedAnimation);y.addClass("open")};C.positionCS=function(b){elParent=b.parent();var c=q?t.maxItems*i:g*i;var d=q?t.maxItems:g;var e=a(window).outerHeight()-(elParent.offset().top-a(window).scrollTop())-elParent.outerHeight()<c?-d*i-elParent.outerHeight()/4:h;e=elParent.offset().top-a(window).scrollTop()<c?h:e;b.css("top",e)};C.refreshCS=function(){G({refreshSelect:true})};C.changeCS=function(b){var c=b.index>0?b.index:a('option[value="'+b.value+'"]',D).index()+1;var d=a("option:nth-child("+c+")",D).attr("value");Q(d,c)};C.disableCS=function(){D.attr("disabled",true);y.addClass("disable")};C.enableCS=function(){D.attr("disabled",false);y.removeClass("disable")};C.setWidthCS=function(a){v.css("width",a);w.css("width",a)};C.init()};a.fn.selectik=function(b){return this.each(function(){if(undefined==a(this).data("selectik")){var c=new a.selectik(this,b);a(this).data("selectik",c)}})};a(window).resize(function(){if(b){if(!a(".custom-select.open").length>0){return}a(".custom-select.open").children("select").data("selectik").positionCS(a(".select-list:visible"))}});a(document).bind("click",function(){if(d){d=false;return}if(b){b=false;if(a(".custom-select.open").length>0){a(".custom-select.open").children("select").data("selectik").hideCS()}}})})(jQuery)